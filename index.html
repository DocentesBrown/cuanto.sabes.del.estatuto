<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Quiz Estatuto Docente ‚Äî Cap. XII: Del Ingreso</title>
  <style>
    :root{
      --azul:#24496e; --violeta:#4d3069; --celeste:#3d8fb0; --beige:#f3efdc; --rojo:#da6863;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--beige); color:var(--azul);
      display:flex; min-height:100vh; align-items:center; justify-content:center;
    }
    .app{
      width:92%; max-width:560px; background:#fff; border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.15); padding:18px 16px 20px;
    }
    header{ text-align:center; margin-bottom:8px;}
    header h1{ margin:0; font-size:1.35rem; color:var(--azul); }
    header p{ margin:6px 0 0; color:var(--violeta); font-weight:600; }
    .timer{ margin:10px 0 14px; font-weight:700; color:var(--rojo); text-align:center; }
    .question{ font-size:1.05rem; font-weight:700; margin:4px 0 10px; color:var(--azul);}
    .options{ display:grid; gap:8px; }
    .btn{
      width:100%; padding:12px 14px; border:0; border-radius:12px; cursor:pointer;
      font-size:1rem; color:#fff; background:var(--celeste); transition:transform .05s ease, opacity .15s ease;
    }
    .btn:hover{ opacity:.9 }
    .btn:active{ transform:scale(.995) }
    .btn.alt{ background:var(--rojo) }
    .btn.dark{ background:var(--azul) }
    .btn.violet{ background:var(--violeta) }
    .btn-row{ display:grid; gap:10px; margin-top:12px; }
    .muted{ color:#666; font-size:.95rem; text-align:center; }
    .hidden{ display:none !important; }
    .result h2{ margin:0 0 6px; color:var(--violeta); }
    .result p{ margin:6px 0; }
    .leaderboard{
      margin-top:14px; background:#fff; border:1px solid #e8e6de; border-radius:14px; overflow:hidden;
    }
    table{ width:100%; border-collapse:collapse; }
    thead th{
      background:var(--violeta); color:#fff; padding:10px; font-weight:700; font-size:.95rem; text-align:center;
    }
    tbody td{
      border-top:1px solid #eee; padding:9px; font-size:.95rem; text-align:center; color:#1d2a38;
    }
    .pill{
      display:inline-block; padding:2px 8px; border-radius:999px; background:#eef4f8; color:#274b6d; font-size:.8rem;
    }
    .topbar{
      display:grid; gap:8px; margin:8px 0 10px;
      grid-template-columns: 1fr;
    }
    @media (min-width:520px){
      .topbar{ grid-template-columns: 1fr 1fr 1fr; }
    }
    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.6);
    }
    .modal-content {
      background: white;
      margin: 20% auto;
      padding: 20px;
      border-radius: 12px;
      width: 80%;
      max-width: 400px;
      text-align: center;
    }
    .modal button {
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: var(--celeste);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .modal button:hover { background: var(--azul); }
    .buttons{
      display:grid; gap:10px; margin-top:16px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Quiz: Estatuto Docente</h1>
      <p>Cap√≠tulo XII ‚Äî Del Ingreso</p>
    </header>

    <!-- Game -->
    <div id="game">
      <div class="timer">‚è≥ Tiempo restante: <span id="timer">20</span>s</div>
      <div class="question" id="question"></div>
      <div class="options" id="options"></div>
      <p class="muted" id="progress"></p>
    </div>

    <!-- Result -->
    <div id="result" class="result hidden">
      <h2>¬°Juego terminado!</h2>
      <p>Puntaje obtenido: <span id="finalScore" class="pill">0</span></p>
      <p>Tiempo total usado: <span id="finalTime" class="pill">0s</span></p>
      <div class="btn-row">
        <button class="btn dark" id="btnReplay">üîÑ Volver a jugar</button>
      </div>
    </div>

    <!-- Leaderboard -->
    <div id="leaderboardWrap" class="leaderboard hidden">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>Jugador</th>
            <th>Puntaje</th>
            <th>Tiempo (s)</th>
            <th>Fecha</th>
          </tr>
        </thead>
        <tbody id="leaderboardBody">
          <tr><td colspan="5" class="muted">Cargando‚Ä¶</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Botones abajo -->
    <div class="buttons topbar">
      <button class="btn violet" id="btnToggleLB">üìä Ver / ocultar posiciones</button>
      <button class="btn dark" id="btnEstatuto">üìï Descargar Estatuto</button>
      <button class="btn alt" id="btnClear">üóëÔ∏è Limpiar tabla</button>
    </div>

    <p class="muted">Puntaje: 100 por acierto + 5 por cada segundo ahorrado.</p>
  </div>

  <!-- Modal -->
  <div id="answerModal" class="modal">
    <div class="modal-content">
      <p id="answerText"></p>
      <button onclick="nextQuestionModal()">Siguiente</button>
    </div>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwX8whu7tz-FnGiZ0Eo9rzOJZKjxF3fQQWpaTXpV98vDG0mIDsg0Ygca_WyEiRYcSOG/exec";
    const TIEMPO_PREGUNTA = 20;

    const questions = [
      {q:"¬øC√≥mo se realiza el ingreso a la docencia seg√∫n el Cap. XII?", options:["Por orden de m√©rito","Por recomendaci√≥n","Por sorteo","Por votaci√≥n"], a:0},
      {q:"¬øQu√© organismo confecciona y aprueba los listados de aspirantes?", options:["Consejo Escolar","DGCyE","Sindicatos","Jefatura Distrital"], a:1},
      {q:"Requisito b√°sico para figurar en los listados de ingreso:", options:["Antig√ºedad","T√≠tulo habilitante","Experiencia","Recomendaci√≥n"], a:1},
      {q:"Periodicidad de inscripci√≥n y actualizaci√≥n de listados:", options:["Anual","Cada 3 a√±os","Cada 5 a√±os","A demanda"], a:0},
      {q:"Criterio principal para ordenar a los aspirantes:", options:["Edad","Fecha de inscripci√≥n","Puntaje","Entrevista"], a:2},
      {q:"¬øC√≥mo se otorgan los cargos a los aspirantes?", options:["Acto p√∫blico","Decisi√≥n del director","Concurso","Inscripci√≥n espont√°nea"], a:0}
    ];

    let current = 0, score = 0, timer=null, timeLeft=TIEMPO_PREGUNTA, totalTimeUsed=0;
    let playerName=null;

    const elTimer = document.getElementById("timer");
    const elQuestion = document.getElementById("question");
    const elOptions = document.getElementById("options");
    const elProgress = document.getElementById("progress");
    const elGame = document.getElementById("game");
    const elResult = document.getElementById("result");
    const elFinalScore = document.getElementById("finalScore");
    const elFinalTime = document.getElementById("finalTime");
    const elLBWrap = document.getElementById("leaderboardWrap");
    const elLBTbody = document.getElementById("leaderboardBody");

    startQuiz();

    function startQuiz(){
      score=0; current=0; totalTimeUsed=0;
      playerName=prompt("Ingres√° tu nombre para jugar:")||"An√≥nimo";
      elResult.classList.add("hidden");
      elGame.classList.remove("hidden");
      renderQuestion();
      startTimer();
    }

    function renderQuestion(){
      const q = questions[current];
      elQuestion.textContent = q.q;
      elOptions.innerHTML = "";
      q.options.forEach((opt,i)=>{
        const btn=document.createElement("button");
        btn.className="btn";
        btn.textContent=opt;
        btn.onclick=()=>selectAnswer(i,btn);
        elOptions.appendChild(btn);
      });
      timeLeft=TIEMPO_PREGUNTA;
      elTimer.textContent=timeLeft;
      elProgress.textContent=`Pregunta ${current+1} de ${questions.length}`;
    }

    function startTimer(){
      clearInterval(timer);
      timer=setInterval(()=>{
        timeLeft--;
        elTimer.textContent=timeLeft;
        if(timeLeft<=0){
          clearInterval(timer);
          totalTimeUsed+=TIEMPO_PREGUNTA;
          showCorrectModal(-1);
        }
      },1000);
    }

    function selectAnswer(idx,btn){
      [...elOptions.children].forEach(b=>b.disabled=true);
      clearInterval(timer);
      const q=questions[current];
      const used=TIEMPO_PREGUNTA-timeLeft;
      totalTimeUsed+=used;
      showCorrectModal(idx);
    }

    function showCorrectModal(selected){
      const q = questions[current];
      const correctOption = q.options[q.a];
      let message = (selected===q.a)?"‚úÖ Correcto!":`‚ùå Incorrecto. La respuesta correcta era: ${correctOption}`;
      if(selected===q.a) score += 100 + (timeLeft*5);
      document.getElementById("answerText").textContent=message;
      document.getElementById("answerModal").style.display="block";
    }

    function nextQuestionModal(){
      document.getElementById("answerModal").style.display="none";
      current++;
      if(current<questions.length){
        renderQuestion();
        startTimer();
      } else endQuiz();
    }

    async function endQuiz(){
      elGame.classList.add("hidden");
      elResult.classList.remove("hidden");
      elFinalScore.textContent=score;
      elFinalTime.textContent=`${totalTimeUsed}s`;
      try{
        await fetch(`${SCRIPT_URL}?action=add&nombre=${encodeURIComponent(playerName)}&puntaje=${encodeURIComponent(score)}&tiempo=${encodeURIComponent(totalTimeUsed)}`);
      }catch(e){ console.error(e); alert("No se pudo guardar el puntaje."); }
      if(!elLBWrap.classList.contains("hidden")) await loadLeaderboard();
    }

    async function loadLeaderboard(){
      elLBTbody.innerHTML=`<tr><td colspan="5" class="muted">Cargando‚Ä¶</td></tr>`;
      try{
        const res=await fetch(`${SCRIPT_URL}?action=get`);
        const rows=(await res.json()).slice(1).filter(r=>r&&r.length);
        rows.sort((a,b)=> (Number(b[1]||0)-Number(a[1]||0)) || (Number(a[2]||0)-Number(b[2]||0)));
        const top20=rows.slice(0,20);
        if(top20.length===0){ elLBTbody.innerHTML=`<tr><td colspan="5" class="muted">No hay registros a√∫n.</td></tr>`; return; }
        elLBTbody.innerHTML="";
        top20.forEach((r,i)=>{
          const tr=document.createElement("tr");
          const fecha=r[3]||"-";
          tr.innerHTML=`<td>${i+1}</td><td>${r[0]||"‚Äî"}</td><td>${Number(r[1]||0)}</td><td>${Number(r[2]||0)}</td><td>${fecha}</td>`;
          elLBTbody.appendChild(tr);
        });
      }catch(e){ console.error(e); elLBTbody.innerHTML=`<tr><td colspan="5" class="muted">Error al cargar tabla.</td></tr>`; }
    }

    // -------- Botones --------
    document.getElementById("btnToggleLB").onclick=()=>{
      elLBWrap.classList.toggle("hidden");
      if(!elLBWrap.classList.contains("hidden")) loadLeaderboard();
    }
    document.getElementById("btnEstatuto").onclick=()=>window.open("https://drive.google.com/file/d/1ct0y2Phs9b45tcL2kLm8Cl6fA6dw8Y_F/view?usp=sharing","_blank");
    document.getElementById("btnClear").onclick=()=>{
      const clave=prompt("Ingrese clave para limpiar tabla:");
      if(clave==="NestorVive#1982") fetch(`${SCRIPT_URL}?action=clear`).then(()=>loadLeaderboard());
      else alert("Clave incorrecta");
    }
    document.getElementById("btnReplay").onclick=startQuiz;
  </script>
</body>
</html>
